{
    "collab_server" : "",
    "contents" : "#' @export\n#' @importFrom utils head tail \n#' @importFrom graphics par axis title plot rect legend mtext text boxplot\n#' @importFrom ggplot2 ggplot guide_legend aes geom_tile facet_grid theme_bw theme element_text scale_fill_manual ggtitle labs guides scale_x_continuous scale_y_discrete unit\n\n\n\n\nvisGroup <- function(data,ID,activity,\n                     type,title,yaxis,xaxis=TRUE,\n                     time=NULL,legendTitle=NULL,\n                     groupBy=NULL,groupFun=NULL,\n                     levels=NULL,heatcol=NULL){\n  \n  ##\n  ## Need code to reset graphical parameters here!!\n  ##\n  dev.new()\n  \n  par(mfrow=c(1,1))\n  if(type == 'boxplot' | type == 'Boxplot'){\n    toPlot <- data[,which(colnames(data)==activity),]\n    ID <- data[,which(colnames(data)==ID),]\n    med <- sort(with(data , tapply(toPlot, ID, median)))\n    myIDs <- names(med)\n    numID <- length(unique(ID))  # 50 1.2; 100 .8     50*1.2   60/50   60/100\n    par(mgp=c(3.3,1,0))\n    par(oma=c(2,.5,.5,.5)) #c(bottom, left, top, right) \n    boxplot(toPlot ~ factor(ID, levels = names(med)),\n            col = \"lightgray\", names=myIDs, \n            main=title,cex.main=1.5,ann = FALSE,xaxt='n')\n    #xlab=\"ID\",cex.lab=1.2,cex.axis=min(1.2,(60/numID)),\n    #ylab=yaxis,las=2)\n    title(ylab=yaxis, cex.lab = 1.2,line = 3.2)\n    #axis(2,at=seq(1,max(toPlot,na.rm=TRUE),5),cex.axis=1.2)\n    if(xaxis==TRUE){\n      axis(1,at=1:numID,labels=myIDs,cex.axis=min(1.2,(60/numID)),las=2)\n      title(xlab=\"ID\", cex.lab = 1.2,line = 4)\n    }\n  }\n  \n  if(type == 'heatmap' | type == 'Heatmap'){\n    \n    if(is.null(groupBy)==FALSE){\n      legendTitle <- paste(legendTitle, \":   \", sep=\"\")\n      Time <- NULL\n      data$Time <- NULL\n      data$Time <- data[,which(colnames(data)==time),]\n      plotBy <- data[,which(colnames(data)==groupBy),]\n      groupingCut <- apply(as.matrix(plotBy), 2, eval(parse(text = groupFun)))\n      grp1.labels <- paste(groupBy,\" < \",groupingCut, sep=\"\")\n      grp2.labels <- paste(groupBy,\" >= \",groupingCut, sep=\"\")\n      data$group <- ifelse(plotBy < groupingCut,grp1.labels,grp2.labels)\n      toPlot <- data[,which(colnames(data)==activity),]\n      ID <- data[,which(colnames(data)==ID),]\n      cat <- cut(toPlot, breaks=levels,dig.lab = 5)\n      data$category <- ifelse(toPlot==0,0,cat)\n      data$labels <- ifelse(toPlot==0,\"0\",as.character(cat))\n      numlevel <- (length(table(data$labels))-1)\n      catnames <- names(table(data$labels))[1:numlevel]\n      data$labels <- factor(data$category,\n                             levels=names(table(data$category)),\n                             labels=c(\"0    \",paste(catnames, \"   \", sep=\"\")),\n                             ordered=TRUE)\n      collapsed <- do.call(\"rbind\", by(data, INDICES=ID, FUN=function(DF) DF[which.max(DF$Time), ]))\n      if(dim(collapsed)[1]>300){stop(\"The heatmap may not be optimal when there are data for more than 300 individuals.\")}\n      \n      p1 <- ggplot(data, aes(Time, as.factor(data$ID)), color=data$labels) + geom_tile(aes(fill = data$labels), colour = \"gray90\") +\n        facet_grid(group ~., scales = \"free_y\") + \n        theme_bw() +\n        theme(strip.text.y = element_text(size = 12, colour = \"gray30\", vjust =0.5, face=\"bold\")) + \n        scale_fill_manual(values=heatcol,drop=FALSE) +\n        theme(axis.text.y=element_text(size=5, color=\"gray60\")) +\n        ggtitle(title) +\n        labs(x=\"Number of days since the first available measurement day\",y=\"ID\") + \n        theme(axis.text.x=element_text(size=12, vjust=0, color=\"gray40\", hjust=0.5)) +\n        theme(axis.text.y=element_text(size=12, vjust=0.4, color=\"gray40\")) +\n        theme(plot.title = element_text(size=14, vjust=2)) +\n        theme(axis.title.x = element_text(size=12,color=\"gray40\", vjust=0)) +\n        theme(axis.title.y = element_text(size=12,color=\"gray40\" , vjust=1.2)) +\n        theme(legend.title=element_text(size=12,color=\"gray30\" , hjust=-10)) + \n        theme(legend.text = element_text(size = 12,color=\"gray30\")) + \n        guides(fill=guide_legend(override.aes=list(colour=\"black\"))) +  \n        #scale_x_continuous(breaks=c(1,2,3,4,5,6,7)) +\n        scale_x_continuous(breaks=1:max(data$Time)) +\n        scale_y_discrete(breaks=c(1,(1:10)*(length(unique(data$ID))/10))) + \n        theme(panel.margin = unit(c(0.3), \"in\")) + \n        theme(legend.position=\"bottom\") +\n        labs(fill = legendTitle) \n      p1\n    }\n    \n    \n    if(is.null(groupBy)==TRUE){\n      legendTitle <- paste(legendTitle, \":   \", sep=\"\")\n      data$Time <- data[,which(colnames(data)==time),]\n      toPlot <- data[,which(colnames(data)==activity),]\n      ID <- data[,which(colnames(data)==ID),]\n      cat <- cut(toPlot, breaks=levels,dig.lab = 5)\n      data$category <- ifelse(toPlot==0,0,cat)\n      data$labels <- ifelse(toPlot==0,\"0\",as.character(cat))\n      numlevel <- (length(table(data$labels))-1)\n      catnames <- names(table(data$labels))[1:numlevel]\n      data$labels <- factor(data$category,\n                             levels=names(table(data$category)),\n                             labels=c(\"0    \",paste(catnames, \"   \", sep=\"\")),\n                             ordered=TRUE)\n      collapsed <- do.call(\"rbind\", by(data, INDICES=ID, FUN=function(DF) DF[which.max(DF$Time), ]))\n      if(dim(collapsed)[1]>300){stop(\"The heatmap may not be optimal when there are data for more than 300 individuals.\")}\n      \n      p1 <- ggplot(data, aes(Time, as.factor(data$ID)), color=data$labels) + geom_tile(aes(fill = data$labels), colour = \"gray90\") +\n        theme_bw() +\n        theme(strip.text.y = element_text(size = 12, colour = \"gray30\", vjust =0.5, face=\"bold\")) + \n        scale_fill_manual(values=heatcol,drop=FALSE) +\n        theme(axis.text.y=element_text(size=5, color=\"gray60\")) +\n        ggtitle(title) +\n        labs(x=\"Number of days since the first available measurement day\",y=\"ID\") + \n        theme(axis.text.x=element_text(size=12, vjust=0, color=\"gray40\", hjust=0.5)) +\n        theme(axis.text.y=element_text(size=12, vjust=0.4, color=\"gray40\")) +\n        theme(plot.title = element_text(size=14, vjust=2)) +\n        theme(axis.title.x = element_text(size=12,color=\"gray40\", vjust=0)) +\n        theme(axis.title.y = element_text(size=12,color=\"gray40\" , vjust=1.2)) +\n        theme(legend.title=element_text(size=12,color=\"gray30\" , hjust=-10)) + \n        theme(legend.text = element_text(size = 12,color=\"gray30\")) + \n        guides(fill=guide_legend(override.aes=list(colour=\"black\"))) +  \n        #scale_x_continuous(breaks=c(1,2,3,4,5,6,7)) +\n        scale_x_continuous(breaks=1:max(data$Time)) +\n        scale_y_discrete(breaks=c(1,(1:10)*(length(unique(data$ID))/10))) + \n        theme(panel.margin = unit(c(0.3), \"in\")) + \n        theme(legend.position=\"bottom\") +\n        labs(fill = legendTitle) \n      p1\n    }\n    p1\n  }\t\n}",
    "created" : 1512343858235.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4158184879",
    "id" : "4BC56094",
    "lastKnownWriteTime" : 1512343869,
    "last_content_update" : 1512343869613,
    "path" : "Z:/My documents/1packages/acc/R/visGroup.R",
    "project_path" : "R/visGroup.R",
    "properties" : {
    },
    "relative_order" : 19,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}